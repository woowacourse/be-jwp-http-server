# 🚀 4단계 - 동시성 확장하기

# 미션 설명

서버는 동시에 여러 사용자가 접속할 수 있다.
현재 서버는 동시 접속자가 많아지면 스레드가 무한대로 생성되면서 서버가 다운될 위험이 있다.
Java에서 제공하는 ThreadPoolExecutor를 사용해서 스레드 풀(thread pool) 기능을 추가하여 스레드를 관리해보자.

# 기능 요구 사항

## 1. Executors로 Thread Pool 적용

`Connector` 클래스의 `void process(final Socket connection)` 메서드에서 요청마다 스레드를 새로 생성하고 있다.
`Connector` 클래스에서 `Executors` 클래스를 사용해서 `ExecutorService` 객체를 만들어보자.
스레드 갯수는 `maxThreads`라는 변수로 지정한다.

```java
// maxThreads를 추가했다.
public Connector(final Container container, final int port, final int acceptCount, final int maxThreads) {
    // 생성자에서 스레드 풀 생성
}
```

## 생각해보기 🤔

- `acceptCount`와 `maxThreads`는 각각 어떤 설정일까?
- 최대 ThradPool의 크기는 250, 모든 Thread가 사용 중인(Busy) 상태이면 100명까지 대기 상태로 만들려면 어떻게 할까?

# 

## 2. 동시성 컬렉션 사용하기

`SessionManager` 클래스에서 `Session` 컬렉션은 여러 스레드가 동시에 접근할 수 있다.
그러다보니 `Session` 컬렉션에 여러 스레드가 동시에 접근하여 읽고 쓰다보면 스레드 안정성을 보장하기 어렵다.
동시성 컬렉션(Concurrent Collections)을 적용해서 스레드 안정성과 원자성을 보장해보자.

# 체크리스트

- Executors로 만든 ExecutorService 객체를 활용하여 스레드 처리를 하고 있다.

# 힌트

- [JAVA 쓰레드풀 분석 - newFixedThreadPool 는 어떻게 동작하는가?](https://hamait.tistory.com/937)
- [Introduction to Thread Pools in Java](https://www.baeldung.com/thread-pool-java-and-guava)
- [A Guide to the Java ExecutorService](https://www.baeldung.com/java-executor-service-tutorial)
- Java Concurrent Animated
  - 자바에서 동시성 처리가 어떻게 되는지 애니메이션 파일을 제공한다.
  - [소스코드](https://github.com/vgrazi/JavaConcurrentAnimatedReboot)를 다운 받아서 직접 실행시켜볼 수 있다.
- [Concurrency](https://docs.oracle.com/javase/tutorial/essential/concurrency/index.html)